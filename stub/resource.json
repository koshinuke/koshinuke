{
	"commit" : "8d68493f20db71abeb77adc251b2a116fe45cdaa",
	"timestamp" : 1323880375,
	"author" : "lanius",
	"message": "fix bugs",
	"contents" : "%23!%20%2Fuser%2Fbin%2Fenv%2F%20python%0A%23%20-*-%20coding%3A%20utf-8%20-*-%0A%23%0A%23%20Copyright%202011%20lanius%0A%23%0A%23%20Licensed%20under%20the%20Apache%20License%2C%20Version%202.0%20(the%20%22License%22)%3B%20you%20may%0A%23%20not%20use%20this%20file%20except%20in%20compliance%20with%20the%20License.%20You%20may%20obtain%0A%23%20a%20copy%20of%20the%20License%20at%0A%23%0A%23%20%20%20%20%20http%3A%2F%2Fwww.apache.org%2Flicenses%2FLICENSE-2.0%0A%23%0A%23%20Unless%20required%20by%20applicable%20law%20or%20agreed%20to%20in%20writing%2C%20software%0A%23%20distributed%20under%20the%20License%20is%20distributed%20on%20an%20%22AS%20IS%22%20BASIS%2C%20WITHOUT%0A%23%20WARRANTIES%20OR%20CONDITIONS%20OF%20ANY%20KIND%2C%20either%20express%20or%20implied.%20See%20the%0A%23%20License%20for%20the%20specific%20language%20governing%20permissions%20and%20limitations%0A%23%20under%20the%20License.%0A%0A%22%22%22Controller%20of%20Heso.%22%22%22%0A%0Afrom%20flask%20import%20Flask%2C%20request%2C%20render_template%2C%20abort%2C%20redirect%2C%20url_for%0Afrom%20setting%20import%20REPO_ROOT%0Afrom%20application%20import%20*%0A%23from%20mock%20import%20*%0A%0A%0Aapp%20%3D%20Flask(__name__)%0A%0A%0A%40app.before_request%0Adef%20before_request()%3A%0A%20%20%20%20pass%0A%0A%0A%40app.after_request%0Adef%20after_request(response)%3A%0A%20%20%20%20response.headers%5B'Server'%5D%20%3D%20'I%20am%20heso%20!'%0A%20%20%20%20return%20response%0A%0A%0A%40app.route('%2Ffavicon.ico')%0Adef%20favicon()%3A%0A%20%20%20%20return%20app.send_static_file('favicon.ico')%0A%0A%0A%40app.route('%2F')%0Adef%20index()%3A%0A%20%20%20%20hesoes%20%3D%20get_all_heso()%0A%20%20%20%20return%20render_template('index.html'%2C%20hesoes%3Dhesoes)%0A%0A%0A%40app.route('%2Fcreate'%2C%20methods%3D%5B'POST'%5D)%0Adef%20create()%3A%0A%20%20%20%20heso%20%3D%20extract_heso(request.form)%0A%0A%20%20%20%20if%20is_invalid(heso)%3A%0A%20%20%20%20%20%20%20%20message%20%3D%20u'all%20fields%20are%20required.'%0A%20%20%20%20%20%20%20%20hesoes%20%3D%20get_all_heso()%0A%20%20%20%20%20%20%20%20return%20render_template('index.html'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hesoes%3Dhesoes%2C%20error_message%3Dmessage)%0A%0A%20%20%20%20create_heso(heso)%0A%20%20%20%20return%20redirect(url_for('index'))%0A%0A%0A%40app.route('%2F%3Creponame%3E'%2C%20methods%3D%5B'GET'%2C%20'POST'%5D)%0Adef%20heso(reponame)%3A%0A%20%20%20%20if%20request.method%20%3D%3D%20'GET'%3A%0A%20%20%20%20%20%20%20%20heso%20%3D%20get_heso(reponame)%0A%20%20%20%20%20%20%20%20comments%20%3D%20get_all_comment(reponame)%0A%20%20%20%20%20%20%20%20return%20render_template('heso.html'%2C%20heso%3Dheso%2C%20comments%3Dcomments)%0A%0A%20%20%20%20if%20request.method%20%3D%3D%20'POST'%3A%0A%20%20%20%20%20%20%20%20heso%20%3D%20extract_heso(request.form)%0A%0A%20%20%20%20%20%20%20%20if%20is_invalid(heso)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20message%20%3D%20u'all%20fields%20are%20required.'%0A%20%20%20%20%20%20%20%20%20%20%20%20hesoes%20%3D%20get_all_heso()%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20render_template('index.html'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hesoes%3Dhesoes%2C%20error_message%3Dmessage)%0A%0A%20%20%20%20%20%20%20%20update_heso(reponame%2C%20heso)%0A%20%20%20%20%20%20%20%20return%20redirect(url_for('heso'%2C%20reponame%3Dreponame))%0A%0A%0A%40app.route('%2F%3Creponame%3E%2Fcomment'%2C%20methods%3D%5B'POST'%5D)%0Adef%20comment(reponame)%3A%0A%20%20%20%20comment%20%3D%20request.form.get('comment')%0A%20%20%20%20add_comment(reponame%2C%20comment)%0A%20%20%20%20return%20redirect(url_for('heso'%2C%20reponame%3Dreponame))%0A%0A%0A%40app.errorhandler(500)%0Adef%20error(e)%3A%0A%20%20%20%20message%20%3D%20u'any%20error%20occured.'%0A%20%20%20%20hesoes%20%3D%20get_all_heso()%0A%20%20%20%20return%20render_template('index.html'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hesoes%3Dhesoes%2C%20error_message%3Dmessage)%0A%0A%0Adef%20extract_heso(form)%3A%0A%20%20%20%20files%20%3D%20%5B%5D%0A%20%20%20%20idx%20%3D%200%0A%20%20%20%20while%20True%3A%0A%20%20%20%20%20%20%20%20filename%20%3D%20form.get('filename%5B%7B0%7D%5D'.format(idx))%0A%20%20%20%20%20%20%20%20document%20%3D%20form.get('document%5B%7B0%7D%5D'.format(idx))%0A%0A%20%20%20%20%20%20%20%20if%20(not%20filename)%20and%20(not%20document)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20break%0A%0A%20%20%20%20%20%20%20%20files.append(%7B'filename'%3A%20filename%2C%20'document'%3A%20document%7D)%0A%20%20%20%20%20%20%20%20idx%20%2B%3D%201%0A%0A%20%20%20%20return%20%7B'files'%3A%20files%2C%20'description'%3A%20form.get('description')%7D%0A%0A%0Adef%20make_app(global_conf%3D%7B%7D)%3A%0A%20%20%20%20app.debug%20%3D%20False%0A%20%20%20%20return%20app%0A%0A%0Aif%20__name__%20%3D%3D%20'__main__'%3A%0A%20%20%20%20host%20%3D%20'localhost'%0A%20%20%20%20port%20%3D%208080%0A%20%20%20%20app%20%3D%20make_app()%0A%20%20%20%20app.debug%20%3D%20True%0A%20%20%20%20app.run(host%3Dhost%2C%20port%3Dport)"
}
