<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>TreeGrid test</title>
		<script type="application/javascript" src="../../../../closure-library/closure/goog/base.js"></script>
		<script type="application/javascript" src="../../../../closure-library/third_party/closure/goog/base.js"></script>
		<script>
			// name resolving hack
			goog.require('goog.string.StringBuffer');
			goog.require('goog.soy');

		</script>
		<script type="application/javascript" src="../../../../js/soyutils_usegoog.js"></script>
		<script src="../deps.js"></script>
		<link rel="stylesheet/less" type="text/css" href="../../../../build/less/repos.less">
		<script type="application/javascript" src="../../../../js/less-1.1.5.min.js"></script>
		<script>
			goog.require('goog.array');
			goog.require('goog.dom');
			goog.require('goog.dom.query');
			goog.require('goog.testing.PropertyReplacer');
			goog.require('goog.testing.jsunit');
			goog.require('goog.testing.recordFunction');
			goog.require('org.koshinuke.ui.TreeGrid');
			goog.require('org.koshinuke.ui.TreeGrid.Node');

		</script>
	</head>
	<body>
		<table>
			<tr id="1">
				<td>a</td>
				<td>aa</td>
				<td>aaa</td>
			</tr>
			<tr id="2">
				<td>b</td>
				<td>bb</td>
				<td>bbb</td>
			</tr>
			<tr id="3">
				<td>c</td>
				<td>cc</td>
				<td>ccc</td>
			</tr>
		</table>
		<table id="tg" class="treegrid"></table>
		<script>
			function testTreeGridModel() {
				var grid = new org.koshinuke.ui.TreeGrid();
				var tgEl = goog.dom.getElement('tg');
				grid.decorate(tgEl);

				var loader = function(path) {
					return [path, "hoge", "moge"];
				}
				var ary = goog.array.reduce(["master", "release", "develop"], function(prev, a) {
					var tgn = new org.koshinuke.ui.TreeGrid.Node(loader);
					tgn.path = a;
					tgn.name = a;
					prev.push(tgn);
					return prev;
				}, []);
				assertEquals("master", ary[0].path);

				goog.array.forEach(ary, function(a) {
					grid.addChild(a, true);
				});
				var tr = goog.dom.query('tr',tgEl)[0];
				assertEquals("master", tr.model.path);
				
			}

			function assertArraysEqual(arr1, arr2) {
				assertEquals('Expected length ' + arr1.length, arr1.length, arr2.length);
				for(var i = 0; i < arr1.length; i++) {
					assertEquals(arr1[i] + ' expected at position ' + i, arr1[i], arr2[i]);
				}
			}

			function testSortPath() {
				var data = ["aaa", "dddd", "bbb", "aaa/bbb", "bbb/ccc/dddd"];
				var expected = ["aaa", "aaa/bbb", "bbb", "bbb/ccc/dddd", "dddd"];
				goog.array.sort(data);
				assertArraysEqual(expected, data);
			}

			function testSibling() {
				var el = goog.dom.getNextElementSibling(goog.dom.getElement("1"));
				assertEquals("2", el.id);
			}
		</script>
	</body>
</html>